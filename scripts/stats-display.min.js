let currentFilter="all";function loadStatsInPanel(){let t=StatsManager.getAllStats();"all"!==currentFilter&&("words"===currentFilter||"sentence"===currentFilter?t=t.filter(t=>t.gameType===currentFilter):"time-based"!==currentFilter&&"word-based"!==currentFilter||(t=t.filter(t=>t.gameMode===currentFilter)));const e=document.getElementById("statsContent");if(0===t.length)return void(e.innerHTML='<div class="no-stats"><p>No statistics available for this filter.</p></div>');const n=buildStatsTable(t);e.innerHTML=n;e.querySelectorAll(".expand-btn").forEach(t=>{t.addEventListener("click",function(){const t=this.getAttribute("data-index"),e=document.getElementById(`extended-${t}`);"none"===e.style.display?(e.style.display="table-row",this.textContent="▾"):(e.style.display="none",this.textContent="▸")})}),"undefined"!=typeof tippy&&tippy("[data-tippy-content]",{placement:"top",arrow:!0})}function buildStatsTable(t){let e='<table class="stats-table">';return e+="<thead><tr>",e+="<th>Date</th>",e+="<th>Type/Mode</th>",e+="<th>Level</th>",e+="<th>Words</th>",e+="<th>WPM</th>",e+="<th>Acc</th>",e+="<th>Time</th>",e+="<th></th>",e+="</tr></thead>",e+="<tbody>",t.forEach((t,n)=>{e+="<tr>";const a=new Date(t.timestamp),s=formatDate(a),r=a.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});e+=`<td><span data-tippy-content="${r}">${s}</span></td>`;const o="sentence"===t.gameType?'<span class="badge badge-sentence" data-tippy-content="Sentence">S</span>':'<span class="badge badge-words" data-tippy-content="Words">W</span>',i="time-based"===t.gameMode?'<span class="badge badge-time" data-tippy-content="Time-based">T</span>':'<span class="badge badge-word" data-tippy-content="Word-based">W</span>';e+=`<td>${o} ${i}</td>`,e+=`<td>${t.settings.level}</td>`;const d=t.performance.words||t.performance.wordsTyped||0;e+=`<td>${d}</td>`;const c=t.performance.wpm;e+=`<td><span class="${c>=60?"wpm-good":c>=40?"wpm-medium":"wpm-low"}">${c.toFixed(0)}</span></td>`;const l=t.performance.accuracy;e+=`<td><span class="${l>=95?"accuracy-high":l>=85?"accuracy-medium":"accuracy-low"}">${l.toFixed(0)}%</span></td>`,e+=`<td>${formatTime(t.performance.time)}</td>`,e+=`<td><span class="expand-btn" data-index="${n}">▸</span></td>`,e+="</tr>",e+=`<tr class="extended-info" id="extended-${n}" style="display: none;">`,e+='<td colspan="9">',e+='<div class="extended-content">',e+=`<strong>Layout:</strong> ${t.settings.layout}<br>`,e+=`<strong>Keyboard:</strong> ${capitalize(t.settings.keyboard)}<br>`,void 0!==t.settings.keyRemapping&&(e+=`<strong>Key remapping:</strong> ${t.settings.keyRemapping?"Yes":"No"}<br>`),void 0!==t.settings.language&&(e+=`<strong>Language:</strong> ${t.settings.language}<br>`),void 0!==t.settings.capitalLettersAllowed&&(e+=`<strong>Capital letters:</strong> ${t.settings.capitalLettersAllowed?"Yes":"No"}<br>`),void 0!==t.settings.nonLatinLetters&&(e+=`<strong>Non-Latin letters:</strong> ${t.settings.nonLatinLetters?"Yes":"No"}<br>`),void 0!==t.settings.punctuation&&""!==t.settings.punctuation&&(e+=`<strong>Punctuation:</strong> ${t.settings.punctuation||"None"}<br>`),e+="</div>",e+="</td></tr>"}),e+="</tbody></table>",e}function formatDate(t){const e=new Date,n=e-t,a=Math.floor(n/1e3),s=Math.floor(a/60),r=Math.floor(s/60),o=Math.floor(r/24);if(0===o)return 0===r?0===s?"Now":`${s}m`:`${r}h`;if(o<7)return`${o}d`;const i={month:"short",day:"numeric"};return t.getFullYear()!==e.getFullYear()&&(i.year="numeric"),t.toLocaleDateString("en-US",i)}function formatTime(t){return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`}function capitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)}document.addEventListener("DOMContentLoaded",function(){const t=document.querySelectorAll(".filter-btn");t.forEach(e=>{e.addEventListener("click",function(){t.forEach(t=>t.classList.remove("active")),this.classList.add("active"),currentFilter=this.dataset.filter,loadStatsInPanel()})});const e=document.getElementById("clearStats");e&&e.addEventListener("click",function(){confirm("Are you sure you want to delete all statistics? This cannot be undone.")&&(StatsManager.clearAllStats(),loadStatsInPanel())})});