const StatsManager={STORAGE_KEY:"stats",MAX_STATS:100,saveGameStats:function(t){try{let e=this._getStatsStructure();return e.data.unshift(t),e.data.length>this.MAX_STATS&&(e.data=e.data.slice(0,this.MAX_STATS)),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),!0}catch(t){return console.error("Error saving stats:",t),!1}},_getStatsStructure:function(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(!t)return{version:1,data:[]};const e=JSON.parse(t);if(Array.isArray(e)){console.log("Migrating stats from old format to new format");return{version:1,data:e.map(t=>{const{version:e,...r}=t;return r})}}return e}catch(t){return console.error("Error getting stats structure:",t),{version:1,data:[]}}},getAllStats:function(){return this._getStatsStructure().data},clearAllStats:function(){try{return localStorage.removeItem(this.STORAGE_KEY),!0}catch(t){return console.error("Error clearing stats:",t),!1}},getStatsByType:function(t){return this.getAllStats().filter(e=>e.gameType===t)},getStatsByMode:function(t){return this.getAllStats().filter(e=>e.gameMode===t)},createStatsObject:function(t){return{timestamp:(new Date).toISOString(),gameType:t.fullSentenceMode?"sentence":"words",gameMode:t.timeLimitMode?"time-based":"word-based",settings:{level:t.level,layout:t.layout,keyboard:t.keyboard,language:t.language,capitalLettersAllowed:!t.onlyLower,nonLatinLetters:t.nonLatin,punctuation:t.punctuation,backspaceCorrection:t.requireBackspaceCorrection,wordScrollingMode:t.wordScrollingMode,showCheatsheet:t.showCheatsheet,playSoundOnClick:t.playSoundOnClick,playSoundOnError:t.playSoundOnError,keyRemapping:t.keyRemapping},performance:{wpm:parseFloat(t.wpm),accuracy:parseFloat(t.accuracy),time:t.time,words:t.wordsTyped,wordsTyped:t.wordsTyped,correctKeystrokes:t.correctKeystrokes,errors:t.errors}}}};